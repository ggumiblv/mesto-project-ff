(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",o)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",o)}var o=function(e){"Escape"===e.key&&t(document.querySelector(".popup_is-opened"))};function n(e,o,n,r,c,u,i,a){var s=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=s.querySelector(".card__image"),p=s.querySelector(".card__title"),d=(document.querySelector(".popup_type_image"),document.querySelector(".popup_type_delete-card")),f=document.querySelector(".popup__button_sure_delete"),_=s.querySelector(".card__delete-button"),m=s.querySelector(".likes-counter"),y=s.querySelector(".card__like-button");p.textContent=e.name,l.src=e.link,l.alt=e.name,s.LikedByMe=!1;var v=u();if(void 0!==e.owner)return s.CreatorID=e.owner._id,s.ElementId=e._id,function(e){0!=e.likes.length?(m.textContent=e.likes.length,e.likes.forEach((function(e){e._id===v._id&&(s.LikedByMe=!0,y.classList.add("card__like-button_is-active"))}))):m.remove}(e),s.CreatorID===v._id?_.addEventListener("click",(function(){r(d),f.addEventListener("click",(function(){o(s,v).then((function(){s.remove()})).finally((function(){f.textContent="Да"})),t(d),f.textContent="Сохранение..."}))})):_.remove(),y.addEventListener("click",(function(){n(s,i,a,v)})),l.addEventListener("click",(function(){c(e)})),s;s.CreatorID=v._id,m.remove}var r=function(e,t,o,n){var r=e.querySelector(".card__like-button"),c=e.querySelector(".likes-counter");!0!==e.LikedByMe?t(e,n).then((function(e){return e.ok?(c.textContent=Number(c.textContent)+1,e.json()):Promise.reject("Ошибка: ".concat(e.status))})).then((function(){e.LikedByMe=!0,r.classList.toggle("card__like-button_is-active")})).catch((function(e){console.log(e)})):(e.LikedByMe=!1,c.textContent=Number(c.textContent)-1,0===c?c.remove:r.classList.toggle("card__like-button_is-active"),o(e,n))},c=function(){return fetch("https://nomoreparties.co/v1/wff-cohort-8/cards ",{headers:{authorization:"275e97d7-7ef3-4926-bcb7-3f2c8fd87314","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},u=function(){return fetch("https://nomoreparties.co/v1/wff-cohort-8/users/me",{headers:{authorization:"275e97d7-7ef3-4926-bcb7-3f2c8fd87314","Content-Type":"application/json"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},i=function(e,t){return fetch("https://nomoreparties.co/v1/wff-cohort-8/cards/".concat(e.ElementId),{method:"DELETE",headers:{authorization:"275e97d7-7ef3-4926-bcb7-3f2c8fd87314"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))},a=function(e,t){return fetch("https://nomoreparties.co/v1/wff-cohort-8/cards/likes/".concat(e.ElementId),{method:"PUT",headers:{authorization:"275e97d7-7ef3-4926-bcb7-3f2c8fd87314"}})},s=function(e,t){return fetch("https://nomoreparties.co/v1/wff-cohort-8/cards/likes/".concat(e.ElementId),{method:"DELETE",headers:{authorization:"275e97d7-7ef3-4926-bcb7-3f2c8fd87314"}})},l=function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(o.inputErrorClass),n.classList.remove(o.errorClass),n.textContent=""},p=function(e,t,o){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?(t.disabled=!1,t.classList.remove(o.inactiveButtonClass)):(t.disabled=!0,t.classList.add(o.inactiveButtonClass))},d=function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);o.forEach((function(o){l(e,o,l),t.formSelector.reset})),n.classList.add(t.inactiveButtonClass)},f=document.querySelector(".places__list"),_=document.querySelector(".profile__edit-button"),m=document.querySelector(".popup_type_edit"),y=document.querySelector(".profile__add-button"),v=document.querySelector(".popup_type_new-card"),h=document.querySelector(".popup_type_image"),S=document.querySelector('[name="edit-profile"]'),b=document.querySelector('[name="new-place"]'),C=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),k=document.querySelector(".popup__input_type_name"),E=document.querySelector(".popup__input_type_description"),L=document.querySelector(".popup__input_type_card-name"),g=document.querySelector(".popup__input_type_url"),x=document.querySelector(".popup__image"),j=document.querySelector(".popup__caption"),w=document.querySelector(".popup__button-card"),B=(document.querySelector(".popup__button_sure_delete"),document.querySelector(".profile__image")),P=document.querySelector(".popup_type_update-avatar"),T=document.querySelector(".popup__input_avatar_url"),A=document.querySelector(".popup__button_sure_change-avatar"),D="";function z(t){e(h),x.src=t.link,x.alt=t.name,j.textContent=t.name}_.addEventListener("click",(function(t){t.preventDefault(),d(m,M),e(m),k.value=C.textContent,E.value=q.textContent})),y.addEventListener("click",(function(t){t.preventDefault(),d(v,M),e(v),L.value="",g.value=""})),document.querySelectorAll(".popup").forEach((function(e){e.querySelector(".popup__close").addEventListener("click",(function(){return t(e)})),e.addEventListener("mousedown",(function(o){o.target===e&&t(e)}))})),m.addEventListener("click",(function(e){e.target===m&&t(m)})),v.addEventListener("click",(function(e){e.target===v&&t(v)})),h.addEventListener("click",(function(e){e.target===h&&t(h)}));var I=document.querySelector(".popup__button-profile");S.addEventListener("submit",(function(e){e.preventDefault(),C.textContent=k.value,q.textContent=E.value;var o=C.textContent,n=q.textContent;I.textContent="Сохранение...",function(e,t){return fetch("https://nomoreparties.co/v1/wff-cohort-8/users/me",{method:"PATCH",headers:{authorization:"275e97d7-7ef3-4926-bcb7-3f2c8fd87314","Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})})}(o,n).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).finally((function(){I.textContent="Сохранить"})),t(m)})),b.addEventListener("submit",(function(o){o.preventDefault();var c=L.value,u=g.value,l=D._id;w.textContent="Сохранение...",function(e,t,o){return fetch("https://nomoreparties.co/v1/wff-cohort-8/cards",{method:"POST",headers:{authorization:"275e97d7-7ef3-4926-bcb7-3f2c8fd87314","Content-Type":"application/json"},body:JSON.stringify({name:e,link:t,_id:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(c,u,l).then((function(t){f.prepend(n(t,i,r,e,z,N,a,s))})).catch((function(e){console.log(e)})).finally((function(){w.textContent="Создать"})),t(v),o.target.reset()}));var M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};!function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var o=Array.from(e.querySelectorAll(t.inputSelector)),n=e.querySelector(t.submitButtonSelector);p(o,n,t),o.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,o){t.validity.patternMismatch?t.setCustomValidity(t.dataset.errorMessage):t.setCustomValidity(""),t.validity.valid?l(e,t,o):function(e,t,o,n){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.inputErrorClass),r.textContent=o,r.classList.add(n.errorClass)}(e,t,t.validationMessage,o)}(e,r,t),p(o,n,t),t.formSelector.reset}))}))}(t,e)}))}({formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"}),c().then((function(t){t.forEach((function(t){f.append(n(t,i,r,e,z,N,a,s))}))})).catch((function(e){console.log(e)}));var N=function(){return D};u().then((function(e){D=e;var t=e.name,o=e.about,n=e.avatar;document.querySelector(".profile__image").style.backgroundImage="url(".concat(n,")"),document.querySelector(".profile__title").textContent=t,document.querySelector(".profile__description").textContent=o})).catch((function(e){console.log(e)})),Promise.all([c(),u(),(B.addEventListener("click",(function(){e(P)})),void A.addEventListener("click",(function(){var e;e=T.value,fetch("https://nomoreparties.co/v1/wff-cohort-8/users/me/avatar",{method:"PATCH",headers:{authorization:"275e97d7-7ef3-4926-bcb7-3f2c8fd87314","Content-Type":"application/json"},body:JSON.stringify({avatar:e})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})),A.textContent="Сохранение..."})))]).then((function(){return console.log("Данные успешно загружены и отображены на странице")})).catch((function(e){return console.error(e)}))})();